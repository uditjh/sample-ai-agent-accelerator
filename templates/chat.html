<!-- Chat Messages -->
<div class="chat-messages">
  {% if conversation.questions|length > 0 %}
  <div id="chat">
    {% for question in conversation.questions %}
    <!-- User Message -->
    <div class="message-bubble message-user">
      <div class="bubble bubble-user">
        <div class="message-header">You</div>
        <div class="message-content">{{question.q}}</div>
      </div>
    </div>

    <!-- AI Message -->
    <div class="message-bubble message-ai">
      <div class="bubble bubble-ai">
        <div class="message-header">ðŸ¤– AI Agent</div>
        <div class="message-content">{{question.a|markdown}}</div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div
    class="text-center"
    style="padding: 3rem 1rem; color: var(--text-secondary)"
  >
    <div style="font-size: 3rem; margin-bottom: 1rem">ðŸ’¬</div>
    <h4>Start a conversation</h4>
    <p>Ask me anything and I'll help you find the answers you need.</p>
  </div>
  {% endif %} {% if sources|length > 0 %}
  <div class="sources-accordion">
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseOne"
            aria-expanded="false"
            aria-controls="collapseOne"
          >
            ðŸ“š Sources
          </button>
        </h2>
        <div
          id="collapseOne"
          class="accordion-collapse collapse"
          data-bs-parent="#accordionExample"
        >
          <div class="accordion-body">
            <ul class="list-unstyled">
              {% for source in sources %}
              <li class="mb-2">
                <a href="{{source.url}}" target="_blank">{{source.name}}</a>
                <span class="badge bg-primary ms-2"
                  >{{(source.score * 100)|int}}%</span
                >
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<!-- Chat Input -->
<div class="chat-input-area">
  <form name="input">
    <div class="input-container">
      <input
        type="hidden"
        name="conversation_id"
        value="{{conversation.conversationId}}"
      />
      <textarea
        name="question"
        class="chat-input"
        rows="2"
        placeholder="Type your message here... (Press Enter to send, Shift+Enter for new line)"
        hx-trigger="keydown[key==='Enter'&&!shiftKey]"
        hx-on:keydown="(event.keyCode===13&&!event.shiftKey)?event.preventDefault():null"
        hx-post="/ask"
        hx-target="#chat-content"
        hx-disabled-elt="this"
        hx-on:htmx:before-request="document.getElementById('indicator').style.display='flex'"
        hx-on:htmx:after-request="document.getElementById('indicator').style.display='none'; this.value=''"
      ></textarea>
      {% include "spinner.html" %}
    </div>
  </form>
</div>
